{
    "global": {
        "stackName": "aws-infra-forge",
        "dualStack": true,
        "description": "Advanced EKS with Karpenter Autoscaling Solution: Delivers a production-ready Kubernetes environment with intelligent, just-in-time node provisioning for optimal resource utilization and cost efficiency. The solution features heterogeneous node pools supporting multiple instance types for workload-specific optimization. Includes comprehensive OS support with Bottlerocket (default), Amazon Linux, and Windows options. Specialized node pools are pre-configured for various compute workloads: standard (CPU-optimized), NVIDIA GPU acceleration, and AWS Neuron (for ML/AI workloads). This solution automatically integrates with EFS or FSx for Lustre for persistent storage needs. For training workloads, it's recommended to avoid using the modern training operator due to compatibility issues, though the training operator version can be freely specified. The deployment is fully customizable with configurable versions for EKS, Karpenter, and the NVIDIA device plugin, enabling precise control over the infrastructure stack."
    },
    "enabledForges": [
        "fsx",
        "eks",
        "hyperpod"
    ],
    "forges": {
        "vpc": {
            "defaults": {
                "id": "vpc",
                "type": "VPC",
                "cidrBlock": "10.69.0.0/16",
                "natGatewayPerAZ": false
            }
        },
        "efs": {
            "defaults": {
                "security": "isolated",
                "subnet": "isolated",
                "type": "EFS"
            },
            "instances": [
                {
                    "id": "efs"
                }
            ]
        },
        "lustre": {
            "defaults": {
                "dataCompressionType": "lz4",
                "deploymentType": "scratch2",
                "fileSystemVersion": "2.15",
                "perUnitStorageThroughput": 250,
                "removalPolicy": "destory",
                "azIndex": 1,
                "security": "isolated",
                "storageCapacityGiB": 1200,
                "subnet": "isolated",
                "type": "LUSTRE"
            },
            "instances": [
                {
                    "id": "fsx"
                }
            ]
        },
        "eks": {
            "defaults": {
                "type": "EKS",
                "security": "private",
                "subnet": "private",
                "instanceTypes": "m6i.large,m6i.xlarge",
                "osType": "bottlerocket",
                "windowsType": "core_2022",
                "keyName": "aws-infra-forge",
                "gpuType": "standard",
                "osArch": "x86_64",
                "minSize": 2,
                "maxSize": 5,
                "diskSize": 30,
                "eksVersion": "1.33",
                "adminUsers": "",
                "controlPlaneAzIndices": "1,2,3",
                "commentNvidiaPluginVersion": "=== https://catalog.ngc.nvidia.com/orgs/nvidia/containers/k8s-device-plugin/tags ===",
                "nvidiaPluginVersion": "0.17.3",
                "commentNeuronDevicePluginVersion": "=== https://gallery.ecr.aws/neuron/neuron-device-plugin ===",
                "neuronDevicePluginVersion": "2.27.7.0",
                "commentEfaPluginVersion": "=== https://artifacthub.io/packages/helm/aws/aws-efa-k8s-device-plugin ===",
                "efaPluginVersion": "0.5.16",
                "commentPodIdentityAgentVersion": "=== https://gallery.ecr.aws/eks/eks-pod-identity-agent ===",
                "podIdentityAgentVersion": "latest",
                "commentAwsLoadBalancerControllerVersion": "=== https://artifacthub.io/packages/helm/aws/aws-load-balancer-controller ===",
                "awsLoadBalancerControllerVersion": "1.13.4",
                "commentCertManagerVersion": "=== https://artifacthub.io/packages/helm/cert-manager/cert-manager ===",
                "certManagerVersion": "1.18.2",
                "commentMetricsServerVersion": "=== https://github.com/kubernetes-sigs/metrics-server/releases ===",
                "metricsServerVersion": "3.13.0",
                "commentMountpointS3CsiDriverVersion": "=== https://github.com/awslabs/mountpoint-s3-csi-driver/releases ===",
                "mountpointS3CsiDriverVersion": "2.0.0",
                "s3BucketName": "aws-infra-forge",
                "deployCsiDriver": false,
                "createStorageClass": false,
                "storageClassName": "sc",
                "createStaticPV": false,
                "createDefaultPVC": false,
                "defaultPVCNamespace": "default",
                "deployTrainingOperator": false,
                "commentTrainingOperatorVersion": "=== https://github.com/kubeflow/trainer/tags ===",
                "trainingOperatorVersion": "1.9.3",
                "commentMlflowVersion": "=== https://artifacthub.io/packages/helm/community-charts/mlflow ===",
                "mlflowVersion": "1.6.2",
                "enableHyperPodComponents": false,
                "useModernTrainingOperator": false,
                "karpenterVersion": "1.6.1",
                "karpenterNodePools": "cpu,gpu,neuron",
                "karpenterOsType": "linux",
                "commentCpu": "=== 通用 CPU 节点池 ===",
                "karpenterCpuInstanceFamilies": "",
                "karpenterCpuInstanceCategories": "c,m,r",
                "karpenterCpuInstanceGenerations": "5,6,7",
                "karpenterCpuInstanceTypes": "",
                "karpenterCpuCapacityTypes": "spot,on-demand",
                "karpenterCpuArchitectures": "amd64,arm64",
                "karpenterCpuDiskSize": 20,
                "karpenterCpuLabels": "workload-type=general",
                "commentGpu": "=== GPU 训练节点池 ===",
                "karpenterGpuInstanceFamilies": "",
                "karpenterGpuInstanceCategories": "",
                "karpenterGpuInstanceGenerations": "",
                "karpenterGpuInstanceTypes": "g5.xlarge,g5.2xlarge,g4dn.xlarge",
                "karpenterGpuCapacityTypes": "spot,on-demand",
                "karpenterGpuArchitectures": "amd64",
                "karpenterGpuDiskSize": 200,
                "karpenterGpuTaints": "nvidia.com/gpu=true:NoSchedule",
                "karpenterGpuLabels": "accelerator=nvidia,workload-type=training",
                "commentNeuron": "=== Neuron 推理节点池 ===",
                "karpenterNeuronInstanceFamilies": "",
                "karpenterNeuronInstanceCategories": "",
                "karpenterNeuronInstanceGenerations": "",
                "karpenterNeuronInstanceTypes": "inf1.xlarge,inf2.xlarge",
                "karpenterNeuronCapacityTypes": "spot,on-demand",
                "karpenterNeuronArchitectures": "amd64",
                "karpenterNeuronDiskSize": 150,
                "karpenterNeuronTaints": "aws.amazon.com/neuron=true:NoSchedule",
                "karpenterNeuronLabels": "accelerator=neuron,workload-type=inference"
            },
            "instances": [
                {
                    "id": "eks",
                    "eksVersion": "1.32",
                    "dependsOn": "LUSTRE:fsx",
                    "deployCsiDriver": true,
                    "createStorageClass": true,
                    "deployTrainingOperator": true,
                    "createStaticPV": true,
                    "enableHyperPodComponents": true,
                    "createDefaultPVC": true
                }
            ]
        },
        "hyperpod": {
            "defaults": {
                "type": "HYPERPOD",
                "security": "private",
                "subnet": "private",
                "clusterName": "hyperpod-eks-cluster",
                "nodeProvisioningMode": "Continuous",
                "nodeRecovery": "Automatic",
                "instanceGroupName": "gpu",
                "instanceType": "ml.g5.xlarge",
                "instanceCount": 2,
                "azIndex": 1,
                "threadsPerCore": 1,
                "eksVersion": "1.32",
                "ebsVolumeSizeGb": 500,
                "createLustre": true,
                "lustreStorageCapacity": 1200,
                "lustreThroughput": 250,
                "useDefaultLifecycle": true,
                "onCreateScript": "on_create.sh",
                "sourceS3Uri": "s3://aws-infra-forge/lifecycle/",
                "executionRolePolicies": "AmazonSageMakerFullAccess,AmazonEKSClusterPolicy,AmazonEKSWorkerNodePolicy,AmazonEKS_CNI_Policy,AmazonEC2ContainerRegistryReadOnly,AmazonSSMManagedInstanceCore,AmazonS3FullAccess"
            },
            "instances": [
                {
                    "id": "hyperpod",
                    "dependsOn": "EKS:eks"
                }
            ]
        }
    }
}
